@page "/customers"
@inject GlobalProgressBar ProgressBar
@inject CustomerService service
@inject NavigationManager NavigationManager

<h3>Customers</h3>
<Divider></Divider>
<Card>
    <CardBody>
        <Fields>
            <Field ColumnSize="ColumnSize.Is4" Horizontal="true" Padding="Padding.Is5.FromLeft">
                <FieldBody>
                    <TextEdit Placeholder="Search by name..." Text="@SearchPhrase" TextChanged="OnSearch" />
                </FieldBody>
            </Field>
        </Fields>
        <GridLoading RecordCount="@(CurrentPage?.TotalCount)"></GridLoading>
        @if (CurrentPage != null && CurrentPage.Page.Any())
        {
            <DataGrid TItem="CustomerSummaryModel" Data="@CurrentPage.Page" Striped="true" ReadData="OnPage" TotalItems="@CurrentPage.TotalCount" PageSize="@PageSize" CurrentPage="@(PageIndex + 1)" Sortable="true">
                <DataGridColumns>
                    <DataGridColumn TItem="CustomerSummaryModel" Field="@nameof(CustomerSummaryModel.Name)" Caption="Name" Sortable="true" Width="70%">
                        <DisplayTemplate>
                            @if ((context as CustomerSummaryModel).IsVIP)
                            { 
                                <i class='fas fa-crown pr-2'></i>
                            }
                            <Blazorise.Link To="@BuildDetailUrl((context as CustomerSummaryModel).Id)">@((context as CustomerSummaryModel).Name)</Blazorise.Link>
                        </DisplayTemplate>
                    </DataGridColumn>
                    <DataGridColumn TItem="CustomerSummaryModel" Field="@nameof(CustomerSummaryModel.LifetimeValue)" Caption="Lifetime Value" Sortable="true" Width="15%" TextAlignment="TextAlignment.Right">
                        <DisplayTemplate>
                            @($"{(context as CustomerSummaryModel)?.LifetimeValue.ToString("c", CultureInfo.CurrentUICulture)}")
                        </DisplayTemplate>
                    </DataGridColumn>
                    <DataGridColumn TItem="CustomerSummaryModel" Field="@nameof(CustomerSummaryModel.CurrentAge)" Caption="Current Age" Sortable="true" />
                </DataGridColumns>
            </DataGrid>

            <DataGridPager CurrentPage="@PageIndex" PageSize="@PageSize" TotalItems="@CurrentPage.TotalCount" OnPageChange="OnPage" OnPageSizeChange="OnPageSizeChanged"></DataGridPager>
        }
    </CardBody>
</Card>
@code {

}
